benchmark:
  name: "CIS Debian Linux 12 Benchmark"
  version: "1.1.0"
  platform: "debian-12"
  release_date: "2024-01-15"
  description: "Security configuration benchmark for Debian GNU/Linux 12 (Bookworm)"
  url: "https://www.cisecurity.org/benchmark/debian_linux"

sections:
  # ===========================================================================
  # SECTION 1 - Initial Setup
  # ===========================================================================
  - number: "1"
    title: "Initial Setup"
    children:
      - number: "1.1"
        title: "Filesystem Configuration"
        children:
          - number: "1.1.1"
            title: "Disable unused filesystems"
            checks:
              - number: "1.1.1.1"
                title: "Ensure cramfs kernel module is not available"
                description: "The cramfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A cramfs image can be used without having to first decompress the image."
                rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
                level: 1
                scored: true
                audit_command: |
                  modprobe -n -v cramfs 2>&1 | grep -E '(cramfs|install)'
                  lsmod | grep cramfs
                expected_output: |
                  install /bin/false
                remediation: |
                  Edit or create the file /etc/modprobe.d/cramfs.conf and add:
                    install cramfs /bin/false
                    blacklist cramfs
                  Run: modprobe -r cramfs 2>/dev/null; rmmod cramfs 2>/dev/null

              - number: "1.1.1.2"
                title: "Ensure squashfs kernel module is not available"
                description: "The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A squashfs image can be used without having to first decompress the image."
                rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
                level: 2
                scored: true
                audit_command: |
                  modprobe -n -v squashfs 2>&1 | grep -E '(squashfs|install)'
                  lsmod | grep squashfs
                expected_output: |
                  install /bin/false
                remediation: |
                  Edit or create the file /etc/modprobe.d/squashfs.conf and add:
                    install squashfs /bin/false
                    blacklist squashfs
                  Run: modprobe -r squashfs 2>/dev/null; rmmod squashfs 2>/dev/null

              - number: "1.1.1.3"
                title: "Ensure udf kernel module is not available"
                description: "The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 based file systems. This is an open vendor filesystem type for data storage on a broad range of media."
                rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
                level: 2
                scored: true
                audit_command: |
                  modprobe -n -v udf 2>&1 | grep -E '(udf|install)'
                  lsmod | grep udf
                expected_output: |
                  install /bin/false
                remediation: |
                  Edit or create the file /etc/modprobe.d/udf.conf and add:
                    install udf /bin/false
                    blacklist udf
                  Run: modprobe -r udf 2>/dev/null; rmmod udf 2>/dev/null

          - number: "1.1.2"
            title: "Configure /tmp"
            checks:
              - number: "1.1.2.1"
                title: "Ensure /tmp is a separate partition"
                description: "The /tmp directory is a world-writable directory used for temporary storage by all users and some applications."
                rationale: "Making /tmp its own filesystem allows an administrator to set additional mount options such as noexec, nosuid, and nodev to limit the attack surface on the temporary storage location."
                level: 1
                scored: true
                audit_command: |
                  findmnt --kernel /tmp
                expected_output: |
                  /tmp is mounted as a separate partition
                remediation: |
                  Configure /etc/fstab or a systemd tmp.mount unit to mount /tmp as a separate partition.
                  Example fstab entry:
                    tmpfs /tmp tmpfs defaults,rw,nosuid,nodev,noexec,relatime,size=2G 0 0
                  Or enable tmp.mount:
                    systemctl unmask tmp.mount
                    systemctl enable --now tmp.mount

              - number: "1.1.2.2"
                title: "Ensure nodev option set on /tmp partition"
                description: "The nodev mount option specifies that the filesystem cannot contain special devices."
                rationale: "Since the /tmp filesystem is not intended to support devices, set this option to ensure that users cannot create a block or character special device in /tmp."
                level: 1
                scored: true
                audit_command: |
                  findmnt --kernel /tmp | grep nodev
                expected_output: |
                  nodev
                remediation: |
                  Edit /etc/fstab and add nodev to the fourth field (mount options) for the /tmp partition.
                  Run: mount -o remount,nodev /tmp

              - number: "1.1.2.3"
                title: "Ensure nosuid option set on /tmp partition"
                description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
                rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /tmp."
                level: 1
                scored: true
                audit_command: |
                  findmnt --kernel /tmp | grep nosuid
                expected_output: |
                  nosuid
                remediation: |
                  Edit /etc/fstab and add nosuid to the fourth field (mount options) for the /tmp partition.
                  Run: mount -o remount,nosuid /tmp

              - number: "1.1.2.4"
                title: "Ensure noexec option set on /tmp partition"
                description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
                rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /tmp."
                level: 1
                scored: true
                audit_command: |
                  findmnt --kernel /tmp | grep noexec
                expected_output: |
                  noexec
                remediation: |
                  Edit /etc/fstab and add noexec to the fourth field (mount options) for the /tmp partition.
                  Run: mount -o remount,noexec /tmp

          - number: "1.1.3"
            title: "Configure /var"
            checks:
              - number: "1.1.3.1"
                title: "Ensure /var is a separate partition"
                description: "The /var directory is used by daemons and other system services to temporarily store dynamic data."
                rationale: "Making /var a separate partition isolates variable data from the root partition, preventing potential denial of service if /var fills up."
                level: 2
                scored: true
                audit_command: |
                  findmnt --kernel /var
                expected_output: |
                  /var is mounted as a separate partition
                remediation: |
                  Create a separate partition for /var and configure it in /etc/fstab:
                    /dev/sdX /var ext4 defaults,nosuid,nodev 0 2

          - number: "1.1.4"
            title: "Configure /var/tmp"
            checks:
              - number: "1.1.4.1"
                title: "Ensure /var/tmp is a separate partition"
                description: "The /var/tmp directory is a world-writable directory used for temporary storage by all users and some applications."
                rationale: "Making /var/tmp its own partition with limited size prevents a single user or application from consuming all available disk space."
                level: 2
                scored: true
                audit_command: |
                  findmnt --kernel /var/tmp
                expected_output: |
                  /var/tmp is mounted as a separate partition
                remediation: |
                  Create a separate partition for /var/tmp and configure it in /etc/fstab:
                    /dev/sdX /var/tmp ext4 defaults,nosuid,nodev,noexec 0 2

          - number: "1.1.5"
            title: "Configure /var/log"
            checks:
              - number: "1.1.5.1"
                title: "Ensure /var/log is a separate partition"
                description: "The /var/log directory is used by system services to store log data."
                rationale: "Making /var/log a separate partition prevents log data from filling up the root filesystem and causing a denial of service."
                level: 2
                scored: true
                audit_command: |
                  findmnt --kernel /var/log
                expected_output: |
                  /var/log is mounted as a separate partition
                remediation: |
                  Create a separate partition for /var/log and configure it in /etc/fstab:
                    /dev/sdX /var/log ext4 defaults,nosuid,nodev,noexec 0 2

          - number: "1.1.6"
            title: "Configure /home"
            checks:
              - number: "1.1.6.1"
                title: "Ensure /home is a separate partition"
                description: "The /home directory is used to store user home directories."
                rationale: "Making /home its own partition limits the amount of space user data can consume, preventing users from filling up the root filesystem."
                level: 2
                scored: true
                audit_command: |
                  findmnt --kernel /home
                expected_output: |
                  /home is mounted as a separate partition
                remediation: |
                  Create a separate partition for /home and configure it in /etc/fstab:
                    /dev/sdX /home ext4 defaults,nosuid,nodev 0 2

              - number: "1.1.6.2"
                title: "Ensure nodev option set on /home partition"
                description: "The nodev mount option specifies that the filesystem cannot contain special devices."
                rationale: "Since the /home filesystem is not intended to support devices, set this option to ensure that users cannot create device files in /home."
                level: 1
                scored: true
                audit_command: |
                  findmnt --kernel /home | grep nodev
                expected_output: |
                  nodev
                remediation: |
                  Edit /etc/fstab and add nodev to the fourth field (mount options) for the /home partition.
                  Run: mount -o remount,nodev /home

      - number: "1.3"
        title: "Filesystem Integrity Checking"
        checks:
          - number: "1.3.1"
            title: "Ensure AIDE is installed"
            description: "AIDE (Advanced Intrusion Detection Environment) takes a snapshot of filesystem state including modification times, permissions, and file hashes which can then be used to compare against the current state of the filesystem to detect modifications to the system."
            rationale: "By monitoring the filesystem state, compromised files can be detected to prevent or limit the exposure of accidental or malicious misconfigurations or modified binaries."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' aide aide-common 2>/dev/null
            expected_output: |
              aide	install ok installed	installed
              aide-common	install ok installed	installed
            remediation: |
              Install AIDE:
                apt install aide aide-common
              Initialize the AIDE database:
                aideinit
                mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db

          - number: "1.3.2"
            title: "Ensure filesystem integrity is regularly checked"
            description: "Periodic checking of the filesystem integrity is needed to detect changes to the filesystem."
            rationale: "Periodic file checking allows the system administrator to determine on a regular basis if critical files have been changed in an unauthorized fashion."
            level: 1
            scored: true
            audit_command: |
              systemctl is-enabled aidecheck.service 2>/dev/null || grep -Ers '^([^#]+\s+)?(\/usr\/s?bin\/|^\s*\/.*)?aide(\.wrapper)?\s(--check|-C)' /etc/cron* /etc/crontab /var/spool/cron/
            expected_output: |
              enabled (or cron job for aide --check exists)
            remediation: |
              Create a systemd timer or cron job to run AIDE regularly:
                echo "0 5 * * * root /usr/bin/aide.wrapper --config /etc/aide/aide.conf --check" >> /etc/crontab
              Or configure aidecheck.timer via systemd.

      - number: "1.4"
        title: "Secure Boot Settings"
        checks:
          - number: "1.4.1"
            title: "Ensure bootloader password is set"
            description: "Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters."
            rationale: "Requiring a boot password upon execution of the boot loader will prevent an unauthorized user from entering boot parameters or changing the boot partition."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*set\s+superusers' /boot/grub/grub.cfg 2>/dev/null
              grep -E '^\s*password' /boot/grub/grub.cfg 2>/dev/null
            expected_output: |
              set superusers="<username>"
              password_pbkdf2 <username> <encrypted-password>
            remediation: |
              Create an encrypted password with grub-mkpasswd-pbkdf2 and add to /etc/grub.d/40_custom:
                set superusers="<username>"
                password_pbkdf2 <username> <encrypted-password>
              Run: update-grub

          - number: "1.4.2"
            title: "Ensure permissions on bootloader config are configured"
            description: "The grub configuration file contains information on boot settings and passwords for unlocking boot options."
            rationale: "Setting the permissions to read and write for root only prevents non-root users from seeing the boot password or changing the boot configuration."
            level: 1
            scored: true
            audit_command: |
              stat -L -c "%a %u %g" /boot/grub/grub.cfg
            expected_output: |
              400 0 0
            remediation: |
              Run the following commands to set permissions on the grub configuration:
                chown root:root /boot/grub/grub.cfg
                chmod u-wx,go-rwx /boot/grub/grub.cfg

  # ===========================================================================
  # SECTION 2 - Services
  # ===========================================================================
  - number: "2"
    title: "Services"
    children:
      - number: "2.1"
        title: "Special Purpose Services"
        checks:
          - number: "2.1.1"
            title: "Ensure xinetd is not installed"
            description: "The eXtended InterNET Daemon (xinetd) is an open source super daemon that replaced the original inetd daemon."
            rationale: "If there are no xinetd services required, it is recommended that the package be removed to reduce the attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' xinetd 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching xinetd
            remediation: |
              Remove xinetd:
                apt purge xinetd

          - number: "2.1.2"
            title: "Ensure avahi-daemon is not installed"
            description: "Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery. Avahi allows programs to publish and discover services and hosts running on a local network."
            rationale: "Automatic discovery of network services is not normally required for system functionality. It is recommended to disable or remove the daemon to reduce the attack surface of the system."
            level: 1
            scored: true
            audit_command: |
              systemctl is-active avahi-daemon 2>/dev/null
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' avahi-daemon 2>/dev/null
            expected_output: |
              inactive
              dpkg-query: no packages found matching avahi-daemon
            remediation: |
              Stop and remove avahi-daemon:
                systemctl stop avahi-daemon.service avahi-daemon.socket
                apt purge avahi-daemon

          - number: "2.1.3"
            title: "Ensure CUPS is not installed"
            description: "The Common Unix Print System (CUPS) provides the ability to print to both local and network printers."
            rationale: "If the system does not need to print jobs or accept print jobs from other systems, it is recommended that CUPS be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' cups 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching cups
            remediation: |
              Remove CUPS:
                apt purge cups

          - number: "2.1.4"
            title: "Ensure DHCP server is not installed"
            description: "The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be automatically assigned IP addresses."
            rationale: "Unless a system is specifically set up to act as a DHCP server, it is recommended that the package be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' isc-dhcp-server 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching isc-dhcp-server
            remediation: |
              Remove the DHCP server:
                apt purge isc-dhcp-server

          - number: "2.1.5"
            title: "Ensure LDAP server is not installed"
            description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
            rationale: "Unless a system is specifically set up to act as an LDAP server, it is recommended that the package be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' slapd 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching slapd
            remediation: |
              Remove the LDAP server:
                apt purge slapd

          - number: "2.1.6"
            title: "Ensure NFS is not installed"
            description: "The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment."
            rationale: "If the system does not export NFS shares or act as an NFS client, it is recommended that the NFS packages be removed to reduce the attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' nfs-kernel-server 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching nfs-kernel-server
            remediation: |
              Remove NFS server:
                apt purge nfs-kernel-server

          - number: "2.1.7"
            title: "Ensure DNS server is not installed"
            description: "The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers, services, or other resources."
            rationale: "Unless a system is specifically designated to act as a DNS server, it is recommended that the package be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' bind9 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching bind9
            remediation: |
              Remove DNS server:
                apt purge bind9

          - number: "2.1.8"
            title: "Ensure FTP server is not installed"
            description: "FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files between a server and clients over a network."
            rationale: "FTP does not protect the confidentiality of data or authentication credentials. It is recommended SFTP be used if file transfer is required. Unless there is a need to run the system as an FTP server, the package should be removed."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' vsftpd 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching vsftpd
            remediation: |
              Remove the FTP server:
                apt purge vsftpd

          - number: "2.1.9"
            title: "Ensure HTTP server is not installed"
            description: "HTTP or web servers provide the ability to host web site content."
            rationale: "Unless a system is specifically designated to act as a web server, it is recommended that the package be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' apache2 nginx 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching apache2
              dpkg-query: no packages found matching nginx
            remediation: |
              Remove the HTTP server:
                apt purge apache2 nginx

          - number: "2.1.10"
            title: "Ensure IMAP and POP3 server is not installed"
            description: "dovecot-imapd and dovecot-pop3d are an open source IMAP and POP3 server for Linux based systems."
            rationale: "Unless POP3 and/or IMAP servers are to be provided by this system, it is recommended that the packages be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' dovecot-imapd dovecot-pop3d 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching dovecot-imapd
              dpkg-query: no packages found matching dovecot-pop3d
            remediation: |
              Remove Dovecot:
                apt purge dovecot-imapd dovecot-pop3d

          - number: "2.1.11"
            title: "Ensure Samba is not installed"
            description: "The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops."
            rationale: "If there is no need to mount directories and file systems to Windows systems, Samba should be removed to reduce the potential attack surface."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' samba 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching samba
            remediation: |
              Remove Samba:
                apt purge samba

          - number: "2.1.12"
            title: "Ensure rsync service is not installed or masked"
            description: "The rsync service can be used to synchronize files between systems over network links."
            rationale: "The rsync service presents a security risk as it uses unencrypted protocols for communication. It should be removed or masked unless required."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' rsync 2>/dev/null
              systemctl is-active rsync 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching rsync
            remediation: |
              Remove or mask rsync:
                apt purge rsync
              Or if rsync is required as a client:
                systemctl stop rsync
                systemctl mask rsync

          - number: "2.1.13"
            title: "Ensure SNMP server is not installed"
            description: "Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring the health and welfare of network equipment."
            rationale: "The SNMP server can communicate using SNMPv1 and SNMPv2c which transmit data in the clear and do not require authentication. Unless the system is designated as an SNMP server, it is recommended the package be removed."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' snmpd 2>/dev/null
            expected_output: |
              dpkg-query: no packages found matching snmpd
            remediation: |
              Remove SNMP server:
                apt purge snmpd

  # ===========================================================================
  # SECTION 3 - Network Configuration
  # ===========================================================================
  - number: "3"
    title: "Network Configuration"
    children:
      - number: "3.1"
        title: "Network Parameters (Host Only)"
        checks:
          - number: "3.1.1"
            title: "Ensure IP forwarding is disabled"
            description: "The net.ipv4.ip_forward flag is used to tell the system whether it can forward packets or not."
            rationale: "Setting the flag to 0 ensures that a system with multiple interfaces (for example, a hard proxy), will never be able to forward packets, and therefore, never serve as a router."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv4.ip_forward
              grep -E -s "^\s*net\.ipv4\.ip_forward\s*=\s*1" /etc/sysctl.conf /etc/sysctl.d/*.conf /usr/lib/sysctl.d/*.conf /run/sysctl.d/*.conf
            expected_output: |
              net.ipv4.ip_forward = 0
            remediation: |
              Set the following parameter in /etc/sysctl.d/60-netipv4.conf:
                net.ipv4.ip_forward = 0
              Run: sysctl -w net.ipv4.ip_forward=0
                   sysctl -w net.ipv4.route.flush=1

          - number: "3.1.2"
            title: "Ensure packet redirect sending is disabled"
            description: "ICMP Redirects are used to send routing information to other hosts. As a host itself does not act as a router, there is no need to send redirects."
            rationale: "An attacker could use a compromised host to send invalid ICMP redirects to other router devices in an attempt to corrupt routing and have users access a system set up by the attacker as opposed to a valid system."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv4.conf.all.send_redirects
              sysctl net.ipv4.conf.default.send_redirects
            expected_output: |
              net.ipv4.conf.all.send_redirects = 0
              net.ipv4.conf.default.send_redirects = 0
            remediation: |
              Set the following parameters in /etc/sysctl.d/60-netipv4.conf:
                net.ipv4.conf.all.send_redirects = 0
                net.ipv4.conf.default.send_redirects = 0
              Run: sysctl -w net.ipv4.conf.all.send_redirects=0
                   sysctl -w net.ipv4.conf.default.send_redirects=0
                   sysctl -w net.ipv4.route.flush=1

      - number: "3.2"
        title: "Network Parameters (Host and Router)"
        checks:
          - number: "3.2.1"
            title: "Ensure source routed packets are not accepted"
            description: "In networking, source routing allows a sender to partially or fully specify the route packets take through the network."
            rationale: "Setting net.ipv4.conf.all.accept_source_route and net.ipv4.conf.default.accept_source_route to 0 disables the system from accepting source routed packets. An attacker could use source routed packets to generate traffic pretending to be from inside a trusted network."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv4.conf.all.accept_source_route
              sysctl net.ipv4.conf.default.accept_source_route
            expected_output: |
              net.ipv4.conf.all.accept_source_route = 0
              net.ipv4.conf.default.accept_source_route = 0
            remediation: |
              Set the following parameters in /etc/sysctl.d/60-netipv4.conf:
                net.ipv4.conf.all.accept_source_route = 0
                net.ipv4.conf.default.accept_source_route = 0
              Run: sysctl -w net.ipv4.conf.all.accept_source_route=0
                   sysctl -w net.ipv4.conf.default.accept_source_route=0
                   sysctl -w net.ipv4.route.flush=1

          - number: "3.2.2"
            title: "Ensure ICMP redirects are not accepted"
            description: "ICMP redirect messages are packets that convey routing information and tell your host to send packets via an alternate path."
            rationale: "Attackers could use bogus ICMP redirect messages to maliciously alter the system routing tables and get them to send packets to incorrect networks and allow your system packets to be captured."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv4.conf.all.accept_redirects
              sysctl net.ipv4.conf.default.accept_redirects
            expected_output: |
              net.ipv4.conf.all.accept_redirects = 0
              net.ipv4.conf.default.accept_redirects = 0
            remediation: |
              Set the following parameters in /etc/sysctl.d/60-netipv4.conf:
                net.ipv4.conf.all.accept_redirects = 0
                net.ipv4.conf.default.accept_redirects = 0
              Run: sysctl -w net.ipv4.conf.all.accept_redirects=0
                   sysctl -w net.ipv4.conf.default.accept_redirects=0
                   sysctl -w net.ipv4.route.flush=1

          - number: "3.2.3"
            title: "Ensure TCP SYN Cookies is enabled"
            description: "When tcp_syncookies is set, the kernel will handle TCP SYN packets normally until the half-open connection queue is full, at which time the SYN cookie functionality kicks in."
            rationale: "Attackers use SYN flood attacks to perform a denial of service by using up all available TCP connection slots. SYN cookies allow the system to keep accepting valid connections even under heavy attack."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv4.tcp_syncookies
            expected_output: |
              net.ipv4.tcp_syncookies = 1
            remediation: |
              Set the following parameter in /etc/sysctl.d/60-netipv4.conf:
                net.ipv4.tcp_syncookies = 1
              Run: sysctl -w net.ipv4.tcp_syncookies=1
                   sysctl -w net.ipv4.route.flush=1

      - number: "3.3"
        title: "IPv6"
        checks:
          - number: "3.3.1"
            title: "Ensure IPv6 router advertisements are not accepted"
            description: "This setting disables the system's ability to accept IPv6 router advertisements."
            rationale: "It is recommended that systems do not accept router advertisements as they could be tricked into routing traffic to compromised machines."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv6.conf.all.accept_ra
              sysctl net.ipv6.conf.default.accept_ra
            expected_output: |
              net.ipv6.conf.all.accept_ra = 0
              net.ipv6.conf.default.accept_ra = 0
            remediation: |
              Set the following parameters in /etc/sysctl.d/60-netipv6.conf:
                net.ipv6.conf.all.accept_ra = 0
                net.ipv6.conf.default.accept_ra = 0
              Run: sysctl -w net.ipv6.conf.all.accept_ra=0
                   sysctl -w net.ipv6.conf.default.accept_ra=0
                   sysctl -w net.ipv6.route.flush=1

          - number: "3.3.2"
            title: "Ensure IPv6 redirects are not accepted"
            description: "This setting prevents the system from accepting ICMP redirects for IPv6."
            rationale: "It is recommended that systems not accept ICMP redirects as they could be tricked into routing traffic to compromised machines."
            level: 1
            scored: true
            audit_command: |
              sysctl net.ipv6.conf.all.accept_redirects
              sysctl net.ipv6.conf.default.accept_redirects
            expected_output: |
              net.ipv6.conf.all.accept_redirects = 0
              net.ipv6.conf.default.accept_redirects = 0
            remediation: |
              Set the following parameters in /etc/sysctl.d/60-netipv6.conf:
                net.ipv6.conf.all.accept_redirects = 0
                net.ipv6.conf.default.accept_redirects = 0
              Run: sysctl -w net.ipv6.conf.all.accept_redirects=0
                   sysctl -w net.ipv6.conf.default.accept_redirects=0
                   sysctl -w net.ipv6.route.flush=1

  # ===========================================================================
  # SECTION 4 - Logging and Auditing
  # ===========================================================================
  - number: "4"
    title: "Logging and Auditing"
    children:
      - number: "4.1"
        title: "Configure System Accounting (auditd)"
        checks:
          - number: "4.1.1"
            title: "Ensure auditd is installed"
            description: "auditd is the userspace component to the Linux Auditing System. It is responsible for writing audit records to the disk."
            rationale: "The capturing of system events provides system administrators with information to allow them to determine if unauthorized access to their system is occurring."
            level: 2
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' auditd audispd-plugins 2>/dev/null
            expected_output: |
              auditd	install ok installed	installed
              audispd-plugins	install ok installed	installed
            remediation: |
              Install auditd and audispd-plugins:
                apt install auditd audispd-plugins

          - number: "4.1.2"
            title: "Ensure auditd service is enabled and active"
            description: "Enable and start the auditd daemon to record system events."
            rationale: "If auditd is not enabled and running, system audit events will not be captured."
            level: 2
            scored: true
            audit_command: |
              systemctl is-enabled auditd
              systemctl is-active auditd
            expected_output: |
              enabled
              active
            remediation: |
              Enable and start auditd:
                systemctl --now enable auditd

          - number: "4.1.3"
            title: "Ensure audit log storage size is configured"
            description: "Configure the maximum size of the audit log file. Once the log reaches the maximum size, it will be rotated and a new log file will be started."
            rationale: "It is important that an appropriate size is determined for log files so that they do not impact the system and audit data is not lost."
            level: 2
            scored: true
            audit_command: |
              grep -E '^\s*max_log_file\s*=' /etc/audit/auditd.conf
            expected_output: |
              max_log_file = 8
            remediation: |
              Edit /etc/audit/auditd.conf and set the max_log_file parameter to an appropriate size:
                max_log_file = 8

      - number: "4.2"
        title: "Configure rsyslog"
        checks:
          - number: "4.2.1"
            title: "Ensure rsyslog is installed"
            description: "rsyslog is a reliable and extended syslog implementation with a modular design providing support for message filtering, TCP based log reception, and many other features."
            rationale: "The security enhancements of rsyslog such as connection-oriented (TCP) transmission of logs, the option to log to database formats, and the encryption of log data en route to a central logging server warrant the use of rsyslog."
            level: 1
            scored: true
            audit_command: |
              dpkg-query -W -f='${binary:Package}\t${Status}\t${db:Status-Status}\n' rsyslog 2>/dev/null
            expected_output: |
              rsyslog	install ok installed	installed
            remediation: |
              Install rsyslog:
                apt install rsyslog

          - number: "4.2.2"
            title: "Ensure rsyslog service is enabled and active"
            description: "Once the rsyslog package is installed, ensure that the service is enabled and active."
            rationale: "If the rsyslog service is not enabled and running, logging may not function correctly and system logs may not be captured."
            level: 1
            scored: true
            audit_command: |
              systemctl is-enabled rsyslog
              systemctl is-active rsyslog
            expected_output: |
              enabled
              active
            remediation: |
              Enable and start rsyslog:
                systemctl --now enable rsyslog

          - number: "4.2.3"
            title: "Ensure rsyslog default file permissions are configured"
            description: "rsyslog will create logfiles that do not already exist on the system. This setting controls what permissions will be applied to these newly created files."
            rationale: "It is important to ensure that log files have the correct permissions to ensure that sensitive log data is archived and protected."
            level: 1
            scored: true
            audit_command: |
              grep '^\$FileCreateMode' /etc/rsyslog.conf /etc/rsyslog.d/*.conf 2>/dev/null
            expected_output: |
              $FileCreateMode 0640
            remediation: |
              Edit /etc/rsyslog.conf or a file in /etc/rsyslog.d/ and add or modify:
                $FileCreateMode 0640

  # ===========================================================================
  # SECTION 5 - Access, Authentication, and Authorization
  # ===========================================================================
  - number: "5"
    title: "Access, Authentication, and Authorization"
    children:
      - number: "5.1"
        title: "Configure time-based job schedulers"
        checks:
          - number: "5.1.1"
            title: "Ensure cron daemon is enabled and active"
            description: "The cron daemon is used to execute batch jobs on the system."
            rationale: "While there may not be user jobs that need to be run on the system, the system does have maintenance jobs that may include security monitoring that have to run, and cron is used to execute them."
            level: 1
            scored: true
            audit_command: |
              systemctl is-enabled cron
              systemctl is-active cron
            expected_output: |
              enabled
              active
            remediation: |
              Enable and start cron:
                systemctl --now enable cron

          - number: "5.1.2"
            title: "Ensure permissions on /etc/crontab are configured"
            description: "The /etc/crontab file is used by cron to control its own jobs."
            rationale: "This file contains information about what system jobs are run by cron. Write access to these files could provide unprivileged users with the ability to elevate their privileges. Read access to these files could provide users with the ability to gain insight on system jobs that run on the system and could provide them a way to gain unauthorized privileged access."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/crontab
            expected_output: |
              600 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/crontab:
                chown root:root /etc/crontab
                chmod 600 /etc/crontab

      - number: "5.2"
        title: "SSH Server Configuration"
        checks:
          - number: "5.2.1"
            title: "Ensure permissions on /etc/ssh/sshd_config are configured"
            description: "The /etc/ssh/sshd_config file contains configuration specifications for sshd."
            rationale: "The /etc/ssh/sshd_config file needs to be protected from unauthorized changes by non-privileged users."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/ssh/sshd_config
            expected_output: |
              600 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/ssh/sshd_config:
                chown root:root /etc/ssh/sshd_config
                chmod og-rwx /etc/ssh/sshd_config

          - number: "5.2.2"
            title: "Ensure SSH root login is disabled"
            description: "The PermitRootLogin parameter specifies if the root user can log in using SSH."
            rationale: "Disallowing root logins over SSH requires system admins to authenticate using their own individual account, then escalating to root via sudo. This in turn limits opportunity for non-repudiation and provides a clear audit trail."
            level: 1
            scored: true
            audit_command: |
              sshd -T -C user=root -C host="$(hostname)" -C addr="$(grep $(hostname) /etc/hosts | awk '{print $1}')" 2>/dev/null | grep -i permitrootlogin
            expected_output: |
              permitrootlogin no
            remediation: |
              Edit /etc/ssh/sshd_config and set:
                PermitRootLogin no
              Restart sshd: systemctl restart sshd

          - number: "5.2.3"
            title: "Ensure SSH PermitEmptyPasswords is disabled"
            description: "The PermitEmptyPasswords parameter specifies if the SSH server allows login to accounts with empty password strings."
            rationale: "Disallowing remote shell access to accounts that have an empty password reduces the probability of unauthorized access to the system."
            level: 1
            scored: true
            audit_command: |
              sshd -T -C user=root -C host="$(hostname)" -C addr="$(grep $(hostname) /etc/hosts | awk '{print $1}')" 2>/dev/null | grep -i permitemptypasswords
            expected_output: |
              permitemptypasswords no
            remediation: |
              Edit /etc/ssh/sshd_config and set:
                PermitEmptyPasswords no
              Restart sshd: systemctl restart sshd

          - number: "5.2.4"
            title: "Ensure SSH MaxAuthTries is set to 4 or less"
            description: "The MaxAuthTries parameter specifies the maximum number of authentication attempts permitted per connection."
            rationale: "Setting the MaxAuthTries parameter to a low number will minimize the risk of successful brute force attacks to the SSH server."
            level: 1
            scored: true
            audit_command: |
              sshd -T -C user=root -C host="$(hostname)" -C addr="$(grep $(hostname) /etc/hosts | awk '{print $1}')" 2>/dev/null | grep -i maxauthtries
            expected_output: |
              maxauthtries 4
            remediation: |
              Edit /etc/ssh/sshd_config and set:
                MaxAuthTries 4
              Restart sshd: systemctl restart sshd

          - number: "5.2.5"
            title: "Ensure SSH Protocol is set to 2"
            description: "Older versions of SSH support two different and incompatible protocols: SSH1 and SSH2. SSH1 has known vulnerabilities."
            rationale: "SSH v1 suffers from insecurities that do not affect SSH v2. Only SSH protocol version 2 connections should be permitted."
            level: 1
            scored: true
            audit_command: |
              sshd -T -C user=root -C host="$(hostname)" -C addr="$(grep $(hostname) /etc/hosts | awk '{print $1}')" 2>/dev/null | grep -i protocol
              grep -Ei '^\s*Protocol\s+' /etc/ssh/sshd_config
            expected_output: |
              Protocol 2 (or no output, as SSH2 is the default in modern OpenSSH)
            remediation: |
              Edit /etc/ssh/sshd_config and set:
                Protocol 2
              Restart sshd: systemctl restart sshd

      - number: "5.3"
        title: "Configure PAM"
        checks:
          - number: "5.3.1"
            title: "Ensure password creation requirements are configured"
            description: "The pam_pwquality.so module checks the strength of passwords. It performs checks such as making sure a password is not a dictionary word, it is a certain length, contains a mix of characters."
            rationale: "Strong passwords protect systems from being hacked through brute force methods."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*minlen\s*=' /etc/security/pwquality.conf
              grep -E '^\s*minclass\s*=' /etc/security/pwquality.conf
            expected_output: |
              minlen = 14
              minclass = 4
            remediation: |
              Install libpam-pwquality if not present:
                apt install libpam-pwquality
              Edit /etc/security/pwquality.conf and set:
                minlen = 14
                minclass = 4
              Or set individual credit options:
                dcredit = -1
                ucredit = -1
                ocredit = -1
                lcredit = -1

          - number: "5.3.2"
            title: "Ensure lockout for failed password attempts is configured"
            description: "Lock out users after n unsuccessful consecutive login attempts."
            rationale: "Locking out user IDs after n unsuccessful consecutive login attempts mitigates brute force password attacks against your systems."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*auth\s+required\s+pam_faillock\.so' /etc/pam.d/common-auth
              grep -E '^\s*deny\s*=' /etc/security/faillock.conf 2>/dev/null
            expected_output: |
              auth required pam_faillock.so preauth
              deny = 4
            remediation: |
              Edit /etc/security/faillock.conf and set:
                deny = 4
                unlock_time = 900
                fail_interval = 900
              Ensure pam_faillock.so is configured in /etc/pam.d/common-auth:
                auth required pam_faillock.so preauth
                auth [default=die] pam_faillock.so authfail

      - number: "5.4"
        title: "User Accounts and Environment"
        checks:
          - number: "5.4.1"
            title: "Ensure password expiration is 365 days or less"
            description: "The PASS_MAX_DAYS parameter in /etc/login.defs allows an administrator to force passwords to expire once they reach a defined age."
            rationale: "The window of opportunity for an attacker to leverage compromised credentials or successfully leverage a brute force attack is limited by the age of the password."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*PASS_MAX_DAYS' /etc/login.defs
            expected_output: |
              PASS_MAX_DAYS 365
            remediation: |
              Edit /etc/login.defs and set:
                PASS_MAX_DAYS 365
              Modify active user parameters:
                chage --maxdays 365 <user>

          - number: "5.4.2"
            title: "Ensure minimum days between password changes is configured"
            description: "The PASS_MIN_DAYS parameter in /etc/login.defs allows an administrator to prevent users from changing their password until a minimum number of days have passed since the last password change."
            rationale: "By restricting the frequency of password changes, an administrator can prevent users from repeatedly changing their password in an attempt to circumvent password reuse controls."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*PASS_MIN_DAYS' /etc/login.defs
            expected_output: |
              PASS_MIN_DAYS 1
            remediation: |
              Edit /etc/login.defs and set:
                PASS_MIN_DAYS 1
              Modify active user parameters:
                chage --mindays 1 <user>

      - number: "5.5"
        title: "Root Login and Su Restriction"
        checks:
          - number: "5.5.1"
            title: "Ensure access to the su command is restricted"
            description: "The su command allows a user to run a command or shell as another user. The program has been superseded by sudo, which allows for more granular control over privileged access."
            rationale: "Restricting the use of su, and using sudo in its place, provides system administrators better control of the escalation of user privileges to execute privileged commands."
            level: 1
            scored: true
            audit_command: |
              grep -E '^\s*auth\s+required\s+pam_wheel\.so\s+use_uid\s+group=' /etc/pam.d/su
            expected_output: |
              auth required pam_wheel.so use_uid group=sudo
            remediation: |
              Edit /etc/pam.d/su and add or uncomment:
                auth required pam_wheel.so use_uid group=sudo
              Add authorized users to the sudo group:
                usermod -aG sudo <user>

  # ===========================================================================
  # SECTION 6 - System Maintenance
  # ===========================================================================
  - number: "6"
    title: "System Maintenance"
    children:
      - number: "6.1"
        title: "System File Permissions"
        checks:
          - number: "6.1.1"
            title: "Ensure permissions on /etc/passwd are configured"
            description: "The /etc/passwd file contains user account information that is used by many system utilities and therefore must be readable for these utilities to operate."
            rationale: "It is critical to ensure that the /etc/passwd file is protected from unauthorized write access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/passwd
            expected_output: |
              644 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/passwd:
                chown root:root /etc/passwd
                chmod u-x,go-wx /etc/passwd

          - number: "6.1.2"
            title: "Ensure permissions on /etc/passwd- are configured"
            description: "The /etc/passwd- file contains backup user account information."
            rationale: "It is critical to ensure that the /etc/passwd- file is protected from unauthorized access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/passwd-
            expected_output: |
              600 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/passwd-:
                chown root:root /etc/passwd-
                chmod u-x,go-rwx /etc/passwd-

          - number: "6.1.3"
            title: "Ensure permissions on /etc/shadow are configured"
            description: "The /etc/shadow file is used to store the information about user accounts that is critical to the security of those accounts, such as the hashed password and other security information."
            rationale: "If attackers can gain read access to the /etc/shadow file, they can easily run a password cracking program against the hashed password to break it. Other security information that is stored in the /etc/shadow file (such as expiration) could also be useful to subvert the user accounts."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/shadow
            expected_output: |
              640 root shadow
            remediation: |
              Run the following commands to set ownership and permissions on /etc/shadow:
                chown root:shadow /etc/shadow
                chmod u-x,g-wx,o-rwx /etc/shadow

          - number: "6.1.4"
            title: "Ensure permissions on /etc/shadow- are configured"
            description: "The /etc/shadow- file is used to store backup information about user accounts that is critical to the security of those accounts, such as the hashed password and other security information."
            rationale: "It is critical to ensure that the /etc/shadow- file is protected from unauthorized access. Although it is protected by default, the file permissions could be changed either inadvertently or through malicious actions."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/shadow-
            expected_output: |
              600 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/shadow-:
                chown root:root /etc/shadow-
                chmod u-x,go-rwx /etc/shadow-

          - number: "6.1.5"
            title: "Ensure permissions on /etc/group are configured"
            description: "The /etc/group file contains a list of all the valid groups defined in the system."
            rationale: "The /etc/group file needs to be protected from unauthorized changes by non-privileged users, but needs to be readable as this information is used with many non-privileged programs."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/group
            expected_output: |
              644 root root
            remediation: |
              Run the following commands to set ownership and permissions on /etc/group:
                chown root:root /etc/group
                chmod u-x,go-wx /etc/group

          - number: "6.1.6"
            title: "Ensure permissions on /etc/gshadow are configured"
            description: "The /etc/gshadow file is used to store the information about groups that is critical to the security of those groups, such as the hashed password and other security information."
            rationale: "If attackers can gain read access to the /etc/gshadow file, they can easily run a password cracking program against the hashed group passwords. Other security information stored in the /etc/gshadow file could also be useful to subvert the groups."
            level: 1
            scored: true
            audit_command: |
              stat -c "%a %U %G" /etc/gshadow
            expected_output: |
              640 root shadow
            remediation: |
              Run the following commands to set ownership and permissions on /etc/gshadow:
                chown root:shadow /etc/gshadow
                chmod u-x,g-wx,o-rwx /etc/gshadow

      - number: "6.2"
        title: "User and Group Settings"
        checks:
          - number: "6.2.1"
            title: "Ensure no world-writable files exist"
            description: "Unix-based systems support variable settings to control access to files. World writable files are the least secure."
            rationale: "Data in world-writable files can be modified and compromised by any user on the system. World writable files may also indicate an incorrectly written script or program that could potentially be the cause of a larger compromise to the system's integrity."
            level: 1
            scored: true
            audit_command: |
              df --local -P 2>/dev/null | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -type f -perm -0002 2>/dev/null
            expected_output: |
              No output (no world-writable files found)
            remediation: |
              Remove the world-writable bit from all files found:
                chmod o-w <filename>
              Investigate each file to ensure that its permissions are correct.

          - number: "6.2.2"
            title: "Ensure no unowned files or directories exist"
            description: "Sometimes when administrators delete users from the password file they neglect to remove all files owned by those users from the system."
            rationale: "A new user who is assigned the deleted user's user ID or group ID may then end up owning these files, and thus have more access on the system than was intended."
            level: 1
            scored: true
            audit_command: |
              df --local -P 2>/dev/null | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -nouser 2>/dev/null
            expected_output: |
              No output (no unowned files found)
            remediation: |
              Locate files that have no user assigned and reset the ownership:
                chown <appropriate_user> <filename>
              Or remove the files if they are not needed.

          - number: "6.2.3"
            title: "Ensure no ungrouped files or directories exist"
            description: "Sometimes when administrators delete groups from the password file they neglect to remove all files owned by those groups from the system."
            rationale: "A new group that is assigned the deleted group's group ID may then end up owning these files, and thus have more access on the system than was intended."
            level: 1
            scored: true
            audit_command: |
              df --local -P 2>/dev/null | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -nogroup 2>/dev/null
            expected_output: |
              No output (no ungrouped files found)
            remediation: |
              Locate files that have no group assigned and reset the group:
                chgrp <appropriate_group> <filename>
              Or remove the files if they are not needed.

          - number: "6.2.4"
            title: "Audit SUID executables"
            description: "The owner of a file can set the file's permissions to run with the owner's or group's permissions, even if the user running the program is not the owner or a member of the group."
            rationale: "There are valid reasons for SUID/SGID programs, but it is important to identify and review such programs to ensure they are legitimate."
            level: 1
            scored: true
            audit_command: |
              df --local -P 2>/dev/null | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -type f -perm -4000 2>/dev/null
            expected_output: |
              Review all SUID files found; only expected system binaries should have SUID set
            remediation: |
              Ensure that no rogue SUID programs have been introduced into the system.
              Review the files returned and confirm they are legitimate. Remove the SUID bit on any unauthorized files:
                chmod u-s <filename>

          - number: "6.2.5"
            title: "Audit SGID executables"
            description: "The owner of a file can set the file's permissions to run with the owner's or group's permissions, even if the user running the program is not the owner or a member of the group."
            rationale: "There are valid reasons for SGID programs, but it is important to identify and review such programs to ensure they are legitimate."
            level: 1
            scored: true
            audit_command: |
              df --local -P 2>/dev/null | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -type f -perm -2000 2>/dev/null
            expected_output: |
              Review all SGID files found; only expected system binaries should have SGID set
            remediation: |
              Ensure that no rogue SGID programs have been introduced into the system.
              Review the files returned and confirm they are legitimate. Remove the SGID bit on any unauthorized files:
                chmod g-s <filename>
