{% extends "base.html" %}
{% block title %}Search Checks - CIS Auditor{% endblock %}
{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Search Checks</h1>
    <p class="mt-1 text-sm text-gray-600">Search and filter across all CIS benchmark checks.</p>
</div>

<!-- Filters -->
<div class="bg-white shadow rounded-lg p-4 mb-6">
    <form method="GET" class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5">
        <div class="lg:col-span-2">
            <label for="q" class="block text-sm font-medium text-gray-700">Search</label>
            <input type="search" name="q" id="q" value="{{ query }}" placeholder="Search by title, number, command..."
                   class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 sm:text-sm">
        </div>
        <div>
            <label for="platform" class="block text-sm font-medium text-gray-700">Platform</label>
            <select name="platform" id="platform" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 sm:text-sm">
                <option value="">All Platforms</option>
                {% for platform in platforms %}
                <option value="{{ platform.slug }}" {% if selected_platform == platform.slug %}selected{% endif %}>{{ platform.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="level" class="block text-sm font-medium text-gray-700">Level</label>
            <select name="level" id="level" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 sm:text-sm">
                <option value="">All Levels</option>
                <option value="1" {% if selected_level == '1' %}selected{% endif %}>Level 1</option>
                <option value="2" {% if selected_level == '2' %}selected{% endif %}>Level 2</option>
            </select>
        </div>
        <div>
            <label for="scored" class="block text-sm font-medium text-gray-700">Scored</label>
            <select name="scored" id="scored" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 sm:text-sm">
                <option value="">All</option>
                <option value="true" {% if selected_scored == 'true' %}selected{% endif %}>Scored Only</option>
                <option value="false" {% if selected_scored == 'false' %}selected{% endif %}>Not Scored Only</option>
            </select>
        </div>
        <div class="lg:col-span-5 flex justify-end">
            <button type="submit" class="inline-flex items-center rounded-md bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary-500">
                <svg class="mr-1.5 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                </svg>
                Search
            </button>
        </div>
    </form>
</div>

<!-- Results -->
{% if checks %}
<div class="mb-4 text-sm text-gray-500">
    Found {{ checks|length }} check{{ 's' if checks|length != 1 else '' }}{% if query %} for "{{ query }}"{% endif %}
</div>
<div class="bg-white shadow rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-24">Check #</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase w-36">Platform</th>
                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-16">Level</th>
                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase w-20">Scored</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for check in checks %}
            <tr class="hover:bg-gray-50 cursor-pointer {% if check.level == 2 %}bg-yellow-50{% endif %}"
                onclick="window.location='{{ url_for('checks.detail', check_id=check.id) }}'">
                <td class="px-4 py-3 whitespace-nowrap text-sm font-mono text-gray-500">{{ check.check_number }}</td>
                <td class="px-4 py-3 text-sm text-gray-900">{{ check.title }}</td>
                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">{{ check.section.benchmark.platform.name }}</td>
                <td class="px-4 py-3 text-center">
                    <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium {% if check.level == 1 %}bg-blue-100 text-blue-700{% else %}bg-yellow-100 text-yellow-700{% endif %}">L{{ check.level }}</span>
                </td>
                <td class="px-4 py-3 text-center">
                    {% if check.scored %}
                    <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-green-100 text-green-700">Yes</span>
                    {% else %}
                    <span class="inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-600">No</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% elif query %}
<div class="text-center py-12 bg-white shadow rounded-lg">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
    </svg>
    <h3 class="mt-2 text-sm font-semibold text-gray-900">No results found</h3>
    <p class="mt-1 text-sm text-gray-500">Try different search terms or adjust your filters.</p>
</div>
{% else %}
<div class="text-center py-12 bg-white shadow rounded-lg">
    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
    </svg>
    <h3 class="mt-2 text-sm font-semibold text-gray-900">Search for checks</h3>
    <p class="mt-1 text-sm text-gray-500">Enter a keyword to search across all benchmarks and platforms.</p>
</div>
{% endif %}
{% endblock %}
