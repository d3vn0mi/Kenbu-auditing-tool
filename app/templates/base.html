<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CIS Auditor{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a' },
                        dark: { 800: '#1a1a2e', 900: '#16213e' },
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        .htmx-indicator { display: none; }
        .htmx-request .htmx-indicator { display: inline-block; }
        pre code { white-space: pre-wrap; word-break: break-word; }
    </style>
</head>
<body class="h-full" hx-boost="true">
    <div class="min-h-full">
        {% if current_user.is_authenticated %}
        <!-- Navigation -->
        <nav class="bg-dark-900 shadow-lg">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center">
                        <a href="{{ url_for('main.dashboard') }}" class="flex items-center space-x-2">
                            <svg class="h-8 w-8 text-primary-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
                            </svg>
                            <span class="text-white font-bold text-lg">CIS Auditor</span>
                        </a>
                        <div class="hidden md:block ml-10">
                            <div class="flex items-baseline space-x-4">
                                <a href="{{ url_for('main.dashboard') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white rounded-md px-3 py-2 text-sm font-medium {% if request.endpoint == 'main.dashboard' %}bg-dark-800 text-white{% endif %}">Dashboard</a>
                                <a href="{{ url_for('benchmarks.list_benchmarks') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white rounded-md px-3 py-2 text-sm font-medium {% if request.endpoint and request.endpoint.startswith('benchmarks.') %}bg-dark-800 text-white{% endif %}">Benchmarks</a>
                                <a href="{{ url_for('platforms.list_platforms') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white rounded-md px-3 py-2 text-sm font-medium {% if request.endpoint and request.endpoint.startswith('platforms.') %}bg-dark-800 text-white{% endif %}">Platforms</a>
                                <a href="{{ url_for('checks.search') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white rounded-md px-3 py-2 text-sm font-medium {% if request.endpoint and request.endpoint.startswith('checks.') %}bg-dark-800 text-white{% endif %}">Search Checks</a>
                                <a href="{{ url_for('audits.list_audits') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white rounded-md px-3 py-2 text-sm font-medium {% if request.endpoint and request.endpoint.startswith('audits.') %}bg-dark-800 text-white{% endif %}">Audits</a>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Search bar -->
                        <div class="hidden md:block">
                            <div class="relative">
                                <input type="search" name="q" placeholder="Search checks..."
                                       hx-get="{{ url_for('checks.search') }}"
                                       hx-trigger="keyup changed delay:300ms"
                                       hx-target="#search-results-dropdown"
                                       hx-include="this"
                                       class="block w-64 rounded-md bg-dark-800 border-0 py-1.5 pl-10 pr-3 text-gray-300 placeholder:text-gray-500 focus:ring-2 focus:ring-primary-500 sm:text-sm"
                                       autocomplete="off">
                                <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                                    <svg class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                                    </svg>
                                </div>
                                <div id="search-results-dropdown" class="absolute top-full left-0 right-0 z-50 mt-1"></div>
                            </div>
                        </div>
                        <!-- User menu -->
                        <span class="text-gray-300 text-sm">{{ current_user.display_name or current_user.username }}</span>
                        <a href="{{ url_for('auth.logout') }}" hx-boost="false" class="text-gray-400 hover:text-white text-sm">Logout</a>
                    </div>
                </div>
            </div>
            <!-- Mobile menu -->
            <div class="md:hidden px-4 pb-3 space-y-1">
                <a href="{{ url_for('main.dashboard') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Dashboard</a>
                <a href="{{ url_for('benchmarks.list_benchmarks') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Benchmarks</a>
                <a href="{{ url_for('platforms.list_platforms') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Platforms</a>
                <a href="{{ url_for('checks.search') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Search</a>
                <a href="{{ url_for('audits.list_audits') }}" class="text-gray-300 hover:bg-dark-800 hover:text-white block rounded-md px-3 py-2 text-base font-medium">Audits</a>
            </div>
        </nav>
        {% endif %}

        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mt-4">
            {% for category, message in messages %}
            <div class="rounded-md p-4 mb-2 {% if category == 'error' %}bg-red-50 text-red-800{% elif category == 'success' %}bg-green-50 text-green-800{% else %}bg-blue-50 text-blue-800{% endif %}">
                <p class="text-sm">{{ message }}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Main content -->
        <main>
            <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <script>
        // Copy to clipboard for code blocks
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('copy-btn') || e.target.closest('.copy-btn')) {
                const btn = e.target.classList.contains('copy-btn') ? e.target : e.target.closest('.copy-btn');
                const code = btn.closest('.code-block').querySelector('code').textContent;
                navigator.clipboard.writeText(code).then(function() {
                    const original = btn.innerHTML;
                    btn.innerHTML = '<svg class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" /></svg>';
                    setTimeout(function() { btn.innerHTML = original; }, 2000);
                });
            }
        });
    </script>
</body>
</html>
